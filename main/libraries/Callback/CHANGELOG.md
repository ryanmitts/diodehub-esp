Based on mainline commit bbcbb07bf634cf6d16d72f45b074b780933bf63f.
